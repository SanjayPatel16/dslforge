<project name="org.dslforge.obfuscation" default="all">

	<property environment="env" />

	<property name="env.BUILD_ID" value="yyyymmdd-hhmm" />

	<property file="./ant-config/${user.name}.build.properties" />
	
	<property file="./ant-config/default.build.properties" />

	<condition property="runs.under.windows">
		<os family="windows" />
	</condition>

	<condition property="runs.under.unix">
		<os family="unix" />
	</condition>

	<condition property="build.eclipse.available">
		<available file="./eclipse" />
	</condition>
	

	<target name="echoprops" description="Echos configuration properties to console">
		<echo>ant.version=${ant.version}</echo>
		<echo>ant.home=${ant.home}</echo>
		<echo>ant.project.name=${ant.project.name}</echo>
		<echo>basedir=${basedir}</echo>
		<echo>user.name=${user.name}</echo>
		<echo>user.home=${user.home}</echo>

		<echo>build.eclipse.version=${build.eclipse.version}</echo>
		<echo>build.eclipse.version.name=${build.eclipse.version.name}</echo>
		<echo>build.eclipse.revision=${build.eclipse.revision}</echo>
		<echo>build.eclipse.timestamp=${build.eclipse.timestamp}</echo>

		<echo>runs.under.windows=${runs.under.windows}</echo>
		<echo>runs.under.unix=${runs.under.unix}</echo>

		<echo>eclipse.downloads.drops.folder.name=${eclipse.downloads.drops.folder.name}</echo>
		<echo>arch.suffix=${arch.suffix}</echo>
		<echo>mvn.build.type.suffix=${mvn.build.type.suffix}</echo>
	</target>

	<target name="clean" description="clean target files">
			<echo>cleaning output folders</echo>
			
			<!-- BasicText -->
			<delete file="../org.dslforge.xtext.common/src/org/dslforge/xtext/common/BasicText.js" />
			<delete file="../org.dslforge.xtext.common/src-js/org/dslforge/xtext/common/global-index.js" />
		
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/Arithmetics.js" />
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/global-index.js" />
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/ace/mode-arithmetics.js" />
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/ace/worker-arithmetics.js" />
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/parser/InternalArithmeticsLexer.js" />
			<delete file="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/parser/InternalArithmeticsParser.js" />
		
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/Domainmodel.js" />
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/global-index.js" />
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/ace/mode-domainmodel.js" />
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/ace/worker-domainmodel.js" />
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/parser/InternalDomainmodelLexer.js" />
			<delete file="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/parser/InternalDomainmodelParser.js" />
		
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/Hummingbird.js" />
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/global-index.js" />
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/ace/mode-hummingbird.js" />
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/ace/worker-hummingbird.js" />
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/parser/InternalHummingbirdLexer.js" />
			<delete file="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/parser/InternalHummingbirdParser.js" />
			
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/MyDsl.js" />
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/global-index.js" />
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/ace/mode-mydsl.js" />
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/ace/worker-mydsl.js" />
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/parser/InternalMyDslLexer.js" />
			<delete file="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/parser/InternalMyDslParser.js" />
			
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/Statemachine.js" />
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/global-index.js" />
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/ace/mode-statemachine.js" />
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/ace/worker-statemachine.js" />
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/parser/InternalStatemachineLexer.js" />
			<delete file="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/parser/InternalStatemachineParser.js" />
	</target>
	
	<target name="all" depends="echoprops, clean, obfuscate" />

	<target name="obfuscate">
	    <taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask"
		classpath="closure/compiler.jar"/>

		<!-- BasicText -->
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../org.dslforge.xtext.common/src/org/dslforge/xtext/common/BasicText.js">
	        <sources dir="input/common/">
	            <file name="BasicText.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../org.dslforge.xtext.common/src-js/org/dslforge/xtext/common/global-index.js">
	        <sources dir="input/common/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>
	    	
		<!-- "arithmetics"-->
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/Arithmetics.js">
	        <sources dir="input/arithmetics/">
	            <file name="Arithmetics.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="advanced" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/global-index.js">
	        <sources dir="input/arithmetics/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>

		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/ace/mode-arithmetics.js">
	        <sources dir="input/arithmetics/ace/">
	        	<file name="mode-arithmetics.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/ace/worker-arithmetics.js">
	        <sources dir="input/arithmetics/ace/">
	        	<file name="worker-arithmetics.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/parser/InternalArithmeticsLexer.js">
	        <sources dir="input/arithmetics/parser/">
	            <file name="InternalArithmeticsLexer.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.arithmetics.web/src-js/org/eclipse/xtext/example/arithmetics/web/parser/InternalArithmeticsParser.js">
	        <sources dir="input/arithmetics/parser/">
	        	<file name="InternalArithmeticsParser.js"/>
	        </sources>
	    </jscomp>		
	
		<!-- "domainmodel" /org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/Domainmodel.js--> 
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/Domainmodel.js">
	        <sources dir="input/domainmodel/">
	            <file name="Domainmodel.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="advanced" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/global-index.js">
	        <sources dir="input/domainmodel/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/ace/mode-domainmodel.js">
	        <sources dir="input/domainmodel/ace/">
	        	<file name="mode-domainmodel.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/ace/worker-domainmodel.js">
	        <sources dir="input/domainmodel/ace/">
	        	<file name="worker-domainmodel.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/parser/InternalDomainmodelLexer.js">
	        <sources dir="input/domainmodel/parser/">
	            <file name="InternalDomainmodelLexer.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.domainmodel.web/src-js/org/xtext/example/domainmodel/web/parser/InternalDomainmodelParser.js">
	        <sources dir="input/domainmodel/parser/">
	        	<file name="InternalDomainmodelParser.js"/>
	        </sources>
	    </jscomp>		

		
		<!-- "hummingbird"  ../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/-->
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/Hummingbird.js">
	        <sources dir="input/hummingbird/">
	            <file name="Hummingbird.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="advanced" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/global-index.js">
	        <sources dir="input/hummingbird/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/ace/mode-hummingbird.js">
	        <sources dir="input/hummingbird/ace/">
	        	<file name="mode-hummingbird.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/ace/worker-hummingbird.js">
	        <sources dir="input/hummingbird/ace/">
	        	<file name="worker-hummingbird.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/parser/InternalHummingbirdLexer.js">
	        <sources dir="input/hummingbird/parser/">
	            <file name="InternalHummingbirdLexer.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.sphinx.examples.xtext.hummingbird.web/src-js/org/eclipse/sphinx/examples/xtext/hummingbird/web/parser/InternalHummingbirdParser.js">
	        <sources dir="input/hummingbird/parser/">
	        	<file name="InternalHummingbirdParser.js"/>
	        </sources>
	    </jscomp>	

		
		<!-- "mydsl" ../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web-->
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/MyDsl.js">
	        <sources dir="input/mydsl/">
	            <file name="MyDsl.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="advanced" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/global-index.js">
	        <sources dir="input/mydsl/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/ace/mode-mydsl.js">
	        <sources dir="input/mydsl/ace/">
	        	<file name="mode-mydsl.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/ace/worker-mydsl.js">
	        <sources dir="input/mydsl/ace/">
	        	<file name="worker-mydsl.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/parser/InternalMyDslLexer.js">
	        <sources dir="input/mydsl/parser/">
	            <file name="InternalMyDslLexer.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.xtext.example.mydsl.web/src-js/org/xtext/example/mydsl/web/parser/InternalMyDslParser.js">
	        <sources dir="input/mydsl/parser/">
	        	<file name="InternalMyDslParser.js"/>
	        </sources>
	    </jscomp>	

		
		<!-- "statemachine" 	../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/-->
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/Statemachine.js">
	        <sources dir="input/statemachine/">
	            <file name="Statemachine.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="advanced" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/global-index.js">
	        <sources dir="input/statemachine/">
	            <file name="global-index.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/ace/mode-statemachine.js">
	        <sources dir="input/statemachine/ace/">
	        	<file name="mode-statemachine.js"/>
	        </sources>
	    </jscomp>
	    <jscomp compilationLevel="simple" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/ace/worker-statemachine.js">
	        <sources dir="input/statemachine/ace/">
	        	<file name="worker-statemachine.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/parser/InternalStatemachineLexer.js">
	        <sources dir="input/statemachine/parser/">
	            <file name="InternalStatemachineLexer.js"/>
	        </sources>
	    </jscomp>
		<jscomp compilationLevel="whitespace" warning="quiet" 
	        debug="false" output="../../examples/org.eclipse.xtext.example.fowlerdsl.web/src-js/org/eclipse/xtext/example/fowlerdsl/web/parser/InternalStatemachineParser.js">
	        <sources dir="input/statemachine/parser/">
	        	<file name="InternalStatemachineParser.js"/>
	        </sources>
	    </jscomp>	


	</target>

</project>